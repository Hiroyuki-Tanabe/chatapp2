<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <title>Chatã‚¢ãƒ—ãƒª</title>
  <link rel='stylesheet' href='css/style.css'>

  <!-- Firebase Appã¯å¿…é ˆã§ã‚ã‚Šã€å¸¸ã«æœ€åˆã«ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ -->
  <script src="https://www.gstatic.com/firebasejs/5.5.2/firebase-app.js"></script>

  <!-- ãƒ­ã‚°ã‚¤ãƒ³ã«å¿…è¦ãªJSã¨CSS -->
  <script src="https://www.gstatic.com/firebasejs/ui/3.5.2/firebase-ui-auth__ja.js"></script>
  <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/3.5.2/firebase-ui-auth.css" />

</head>

<body>
  <!-- ãƒ–ãƒ©ã‚¦ã‚¶ã®ç”»é¢ã«è¦‹ãˆã‚‹å†…å®¹ -->


  <div class="tab_wrap">
    <input id="tab1" type="radio" name="tab_btn" checked>
    <input id="tab2" type="radio" name="tab_btn"> 
  
    <div class="tab_area">
      <label class="tab1_label" for="tab1">å…¥åŠ›</label>
      <label class="tab2_label" for="tab2">é–²è¦§</label>
    </div>
    <div class="panel_area">
      <div id="panel1" class="tab_panel">
        <form method="POST" name="form1" onsubmit="return check()">
          <table class="ask" id="ask_table" rules="rows">
            <tr align="left">
              <th>ã‚¿ã‚¤ãƒˆãƒ«</th>
              <td><input type="text" name="key"  id="username" size="30"></td>
            </tr>
            <tr align="left">
              <th>å†…å®¹</th>
              <td><textarea name="memo" id="text" rows="5" cols="41"></textarea></td>
            </tr>
            <tr align="left">
              <th>ä»Šæ—¥ã®ç‚¹æ•°</th>
              <td><input type="text" name="point"  id="point" size="42"></td>
            </tr>
            <tr align="left">
              <th>æ—¥ä»˜</th>
              <td><input type="date"  name="date" id="date" min= &{kyou}; style="width:300px"></td>
            </tr>
            <tr align="left">
              <th>è¨˜å…¥è€…</th>
              <td>
                <select name="example" name="gender" id="gender">
                  <option value="man">man</option>
                  <option value="woman">woman</option>
                </select>
              </td>
            </tr>
          </table>
          <!-- é€ä¿¡ãƒœã‚¿ãƒ³ -->
          <button id="send">é€ä¿¡</button>
        </form>
      </div>
      <div id="panel2" class="tab_panel">
        <div id="icon"></div>
        <div id="output"></div>
      </div>
    </div>
  </div>
    


  

  <!-- ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹ç®‡æ‰€ -->
  
  </div>ã€€ã€€ã€€ã€€
  <!-- ãƒ–ãƒ©ã‚¦ã‚¶ã®ç”»é¢ã«è¦‹ãˆã‚‹å†…å®¹ -->


  <!-- JQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <!-- JQuery -->

  <!--** ä»¥ä¸‹Firebase **-->
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <!-- firebaseã®verãŒå¤‰ã‚ã‚‹ã®ã§ã€æ•°å­—ãŒã©ã‚“ã©ã‚“å¤‰åŒ–ã—ã¾ã™ğŸ™‹â€â™€ï¸ -->
  <!-- ã“ã“ã«firebaseã®scriptã‚’è²¼ã‚Šä»˜ã‘ã‚‹ -->
  <script src="https://www.gstatic.com/firebasejs/7.14.2/firebase.js"></script>

  <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#config-web-app -->


  <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyAYQ96M8rfXybTJ6xRHJ5iERbBLzmKjWJ8",
      authDomain: "dev-chat-31.firebaseapp.com",
      databaseURL: "https://dev-chat-31.firebaseio.com",
      projectId: "dev-chat-31",
      storageBucket: "dev-chat-31.appspot.com",
      messagingSenderId: "245861826242",
      appId: "1:245861826242:web:68516323f9ec3ff6fb055b"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    //firebaseã®ãƒ‡ãƒ¼ã‚¿ãƒ¼ãƒ™ãƒ¼ã‚¹ï¼ˆä¿å­˜ã•ã›ã‚‹å ´æ‰€ï¼‰ã‚’ä½¿ã„ã¾ã™ã‚ˆ
    const newPostRef = firebase.database().ref();

    // ã“ã“ã‹ã‚‰ä¸‹ã«jqueryã®å‡¦ç†ã‚’æ›¸ã„ã¦ç·´ç¿’ã—ã¾ã™

    // é€ä¿¡ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚‰æ¬¡ã®å‡¦ç†ã‚’ã™ã‚‹
    $("#send").on("click", function () {
      // ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã§é€ã‚‹
      newPostRef.push({
        username: $("#username").val(), //åå‰
        text: $("#text").val(), //ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢
        point: $("#point").val(), //ç‚¹æ•°
        date: $("#date").val(), //æ—¥ä»˜
        gender: $("#gender").val(), //æ€§åˆ¥
      })
      $("#text").val(""); //ç©ºã«ã™ã‚‹
      $("#username").val(""); //ç©ºã«ã™ã‚‹
      $("#point").val(""); //ç©ºã«ã™ã‚‹
      $("#date").val(""); //ç©ºã«ã™ã‚‹
      $("#gender").val(""); //ç©ºã«ã™ã‚‹
    });

    // å—ä¿¡å‡¦ç†
    newPostRef.on("child_added", function (data) {
      let v = data.val(); //ã“ã“ã«ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒå…¨ã¦å…¥ã£ã¦ãã‚‹
      // let k = data.key; //ä»Šå›ã¯ä½¿ã„ã¾ã›ã‚“

      // console.log(v); //vã®å¤‰æ•°ã«å…¥ã£ã¦ã„ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å…¨ã¦ã¿ã‚‹
      // console.log(v.gender); 
      // genderã‚’1ä»¶ã¥ã¤å–ã‚Šå‡ºã™
      var count = 0; //è¡Œæ•°ã‚’æ•°ãˆãŸã„
      var pic_man = "<img src='./imgs/man.jpg' width='80' height='80'>"
      var pic_woman = "<img src='./imgs/woman.jpg' width='80' height='80'>"
      for (const elem of Object.values(v)){
        // console.log("ã“ã“ã«ç”»åƒã‚’ã„ã‚Œã‚‹");
        if(count == 4){
          count = 0;
          console.log('ã“ã“ã«ç”»åƒã‚’ã„ã‚Œã‚‹',count);
          if(gender == 'man'){
            // $("#output").append('ç”·ã§ã™ï¼');
            $("#output").append(pic_man);
          }
          else{
            // $("#output").append('å¥³ã§ã™ï¼');
            $("#output").append(pic_woman);
          }
        // æ”¹è¡Œ
        var linebreak = document.createElement("br");
        $("#output").append(linebreak);

        }else{
          if(count == 1){
           gender = elem; 
          }
          console.log(elem);
          count = count+1;
          console.log('countã¯',count);
          $("#output").append(elem, ' ');
          // if elms=1ãªã‚‰å¤‰æ•°genderã«å…¥ã‚Œã¦ãŠã
          
        }
        
      }

      var pic = "<img src='./imgs/tuku.jpg' width='50' height='50'>"
      let str = `${pic}<br><p>${v.username}<br>${v.text}<br>${v.point}<br>${v.date}<br>${v.gender}</p>`;

      // ã“ã“ã§ãƒ‡ãƒ¼ã‚¿ã‚’htmlã«åŸ‹ã‚è¾¼ã‚€
      // $("#icon").append("<img src='./imgs/tuku.jpg' width='50' height='50'>");
      // $("#output").append(str);
    })

    $("#text").on("keydown", function (e) {
      console.log(e, "event");

      if (e.keyCode === 13) {
        newPostRef.push({
          username: $("#username").val(), //åå‰
          text: $("#text").val(), //ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢
          point: $("#point").val(), //ç‚¹æ•°
          date: $("#date").val(), //æ—¥ä»˜
          gender: $("#gender").val(), //æ€§åˆ¥
        })
        $("#text").val(""); //ç©ºã«ã™ã‚‹
        $("#username").val(""); //ç©ºã«ã™ã‚‹
        $("#point").val(""); //ç©ºã«ã™ã‚‹
        $("#date").val(""); //ç©ºã«ã™ã‚‹
        $("#gender").val(""); //ç©ºã«ã™ã‚‹
      }
    })


    $(function(){

/* twitter */
!function(d,s,id){
  var js, fjs=d.getElementsByTagName(s)[0];
  if(!d.getElementById(id)){
    js=d.createElement(s);
    js.id=id;
    js.src="//platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js,fjs);
  }
}(document,"script","twitter-wjs");

/* facebook */
(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1&appId=236187796455704";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));

/* g-plus */
window.___gcfg = {lang: 'ja'};
(function() {
  var po = document.createElement('script');
  po.type = 'text/javascript';
  po.async = true;
  po.src = 'https://apis.google.com/js/plusone.js';
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(po, s);
})();

/* hatena */
(function() {
  var po = document.createElement('script');
  po.type = 'text/javascript';
  po.async = true;
  po.charset = 'utf-8';
  po.src = 'http://b.st-hatena.com/js/bookmark_button.js';
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(po, s);
})();

});




  </script>

  <!-- Initialize Firebase -->
  <!-- <script src="/__/firebase/init.js"></script>
  <script src="/__/firebase/7.14.2/firebase-auth.js"></script> -->

</body>

</html>